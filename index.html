<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YannApp</title>
</head>
<body>
  <h1>Bienvenue sur YannApp</h1>
  <button id="login-btn">Se connecter avec Google</button>
  <div id="user-info" style="display:none;">
    <p>Connecté en tant que : <span id="user-name"></span></p>
    <input type="text" id="task-input" placeholder="Nouvelle tâche" />
    <button id="add-task-btn">Ajouter</button>
    <ul id="task-list"></ul>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDOihVhSLNKxcMKsdg_iSd0P_1-K7eRkXw",
      authDomain: "yannapp-d9ea1.firebaseapp.com",
      projectId: "yannapp-d9ea1",
      storageBucket: "yannapp-d9ea1.firebasestorage.app",
      messagingSenderId: "34473176681",
      appId: "1:34473176681:web:bc6d23f91bdfe1b2f4fcf8"
    };

    // Initialisation Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById("login-btn");
    const userInfo = document.getElementById("user-info");
    const userName = document.getElementById("user-name");
    const taskInput = document.getElementById("task-input");
    const addTaskBtn = document.getElementById("add-task-btn");
    const taskList = document.getElementById("task-list");

    let currentUser = null;

    // Connexion utilisateur
    loginBtn.addEventListener("click", () => {
      signInWithPopup(auth, provider)
        .then((result) => {
          currentUser = result.user;
          userName.textContent = currentUser.displayName;
          userInfo.style.display = "block";
          loginBtn.style.display = "none";
          loadTasks();
        })
        .catch((error) => {
          console.error("Erreur de connexion :", error);
        });
    });

    // Observer l'état de connexion
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        userName.textContent = currentUser.displayName;
        userInfo.style.display = "block";
        loginBtn.style.display = "none";
        loadTasks();
      }
    });

    // Ajouter une tâche
    addTaskBtn.addEventListener("click", async () => {
      const task = taskInput.value.trim();
      if (task === "") return;
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      let tasks = [];
      if (docSnap.exists()) {
        tasks = docSnap.data().tasks || [];
      }
      tasks.push(task);
      await setDoc(docRef, { tasks });
      taskInput.value = "";
      displayTasks(tasks);
    });

    // Charger les tâches
    async function loadTasks() {
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const tasks = docSnap.data().tasks || [];
        displayTasks(tasks);
      }
    }

    // Afficher les tâches
    function displayTasks(tasks) {
      taskList.innerHTML = "";
      tasks.forEach((task) => {
        const li = document.createElement("li");
        li.textContent = task;
        taskList.appendChild(li);
      });
    }
  </script>
</body>
</html>
